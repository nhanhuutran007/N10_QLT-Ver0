<UserControl x:Class="QLKDPhongTro.Presentation.Views.Components.TopbarControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:windows="clr-namespace:QLKDPhongTro.Presentation.Views.Windows"
             Height="80">
    
    <UserControl.Resources>
        <!-- Style cho các nút trong topbar -->
        <Style x:Key="TopbarButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" 
                                CornerRadius="6" 
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#F2F6FA"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </UserControl.Resources>

    <!-- Top Bar -->
    <Border Background="White" CornerRadius="12" Margin="10,0,10,20">
        <Border.Effect>
            <DropShadowEffect ShadowDepth="1" Color="#D6D8E0" Opacity="0.3" BlurRadius="10"/>
        </Border.Effect>

        <Grid Margin="12">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <!-- Nút Menu (Hamburger Icon) -->
            <Button Grid.Column="0" Width="40" Height="40" Style="{StaticResource TopbarButtonStyle}" VerticalAlignment="Center" Click="MenuButton_Click">
                <Path Data="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z" 
                      Fill="#586A84" Stretch="Uniform" Width="20"/>
            </Button>

            <!-- Thanh Tìm Kiếm -->
            <Border Grid.Column="1" Background="#F2F6FA" CornerRadius="6" Width="260" Height="40" HorizontalAlignment="Left" Margin="10,0,0,0">
                <Grid>
                    <Path Data="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0 0 16 9.5 6.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z" 
                          Fill="#586A84" Width="16" Height="16" Stretch="Uniform" Margin="10,0" HorizontalAlignment="Left"/>
                    <!-- Placeholder Text -->
                    <TextBlock Text="Tìm kiếm" Foreground="#7D8FA9" FontSize="14" IsHitTestVisible="False" VerticalAlignment="Center" Margin="36,0,0,0"/>
                    <!-- Actual TextBox -->
                    <TextBox x:Name="SearchTextBox" Background="Transparent" BorderThickness="0" VerticalAlignment="Center" Margin="36,0,10,0" TextChanged="SearchTextBox_TextChanged"/>
                </Grid>
            </Border>

            <!-- Các Icon và Avatar bên phải -->
            <StackPanel Grid.Column="2" Orientation="Horizontal" HorizontalAlignment="Right" VerticalAlignment="Center">
                <Button Width="40" Height="40" Style="{StaticResource TopbarButtonStyle}" Click="SettingsButton_Click">
                    <Path Data="M19.43 12.98c.04-.32.07-.64.07-.98s-.03-.66-.07-.98l2.11-1.65c.19-.15.24-.42.12-.64l-2-3.46c-.12-.22-.39-.3-.61-.22l-2.49 1c-.52-.4-1.08-.73-1.69-.98l-.38-2.65C14.46 2.18 14.25 2 14 2h-4c-.25 0-.46.18-.49.42l-.38 2.65c-.61.25-1.17.59-1.69.98l-2.49-1c-.23-.09-.49 0-.61.22l-2 3.46c-.13.22-.07.49.12.64l2.11 1.65c-.04.32-.07.65-.07.98s.03.66.07.98l-2.11 1.65c-.19.15-.24.42-.12.64l2 3.46c.12.22.39.3.61.22l2.49-1c.52.4 1.08.73 1.69.98l.38 2.65c.03.24.24.42.49.42h4c.25 0 .46-.18.49-.42l.38-2.65c.61-.25 1.17-.59 1.69-.98l2.49 1c.23.09.49 0 .61.22l2-3.46c.12-.22.07-.49-.12-.64l-2.11-1.65zM12 15.5c-1.93 0-3.5-1.57-3.5-3.5s1.57-3.5 3.5-3.5 3.5 1.57 3.5 3.5-1.57 3.5-3.5 3.5z" 
                          Fill="#586A84" Stretch="Uniform" Width="20"/>
                </Button>
                
                <!-- Nút Avatar và Popup -->
                <ToggleButton x:Name="ProfileButton" Width="40" Height="40" Margin="10,0,0,0" Background="Transparent" BorderThickness="0" Cursor="Hand">
                    <Ellipse Width="40" Height="40">
                        <Ellipse.Fill>
                            <ImageBrush ImageSource="pack://application:,,,/Resources/Images/avatar.jpg"/>
                        </Ellipse.Fill>
                    </Ellipse>
                </ToggleButton>

                <Popup IsOpen="{Binding IsChecked, ElementName=ProfileButton}" 
                       StaysOpen="False" 
                       PlacementTarget="{Binding ElementName=ProfileButton}"
                       Placement="Bottom"
                       AllowsTransparency="True"
                       PopupAnimation="Fade">
                    <!-- Tham chiếu đến namespace của UserControl -->
                    <windows:ProfileDropDown Margin="0,10,0,0"/> 
                </Popup>
            </StackPanel>
        </Grid>
    </Border>
</UserControl>
