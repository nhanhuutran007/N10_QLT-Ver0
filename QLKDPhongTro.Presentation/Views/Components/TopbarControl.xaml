<UserControl x:Class="QLKDPhongTro.Presentation.Views.Components.TopbarControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:windows="clr-namespace:QLKDPhongTro.Presentation.Views.Windows"
             Height="80">

    <UserControl.Resources>
        <!-- Style cho các nút trong topbar -->
        <Style x:Key="TopbarButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" 
                                CornerRadius="6" 
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#F2F6FA"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </UserControl.Resources>

    <!-- Top Bar -->
    <Border Background="White" CornerRadius="12" Margin="10,0,10,0">
        <Border.Effect>
            <DropShadowEffect ShadowDepth="1" Color="#D6D8E0" Opacity="0.3" BlurRadius="10"/>
        </Border.Effect>

        <Grid Margin="12">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <!-- Nút Menu (Hamburger Icon) -->
            <Button Grid.Column="0" Width="40" Height="40" Style="{StaticResource TopbarButtonStyle}" VerticalAlignment="Center" Click="MenuButton_Click">
                <Path Data="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z" 
                      Fill="#586A84" Stretch="Uniform" Width="20"/>
            </Button>

            <!-- Thanh Tìm Kiếm -->
            <Border Grid.Column="1" Background="#F2F6FA" CornerRadius="6" Width="260" Height="40" HorizontalAlignment="Left" Margin="10,0,0,0">
                <Grid>
                    <Path Data="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0 0 16 9.5 6.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z" 
                          Fill="#586A84" Width="16" Height="16" Stretch="Uniform" Margin="10,0" HorizontalAlignment="Left"/>
                    <!-- Placeholder Text -->
                    <TextBlock Text="Tìm kiếm" Foreground="#7D8FA9" FontSize="14" IsHitTestVisible="False" VerticalAlignment="Center" Margin="36,0,0,0">
                        <TextBlock.Style>
                            <Style TargetType="TextBlock">
                                <Setter Property="Visibility" Value="Collapsed"/>
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding Text, ElementName=SearchTextBox}" Value="">
                                        <Setter Property="Visibility" Value="Visible"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </TextBlock.Style>
                    </TextBlock>
                    <!-- Actual TextBox -->
                    <TextBox x:Name="SearchTextBox" Background="Transparent" BorderThickness="0" VerticalAlignment="Center" Margin="36,0,10,0" TextChanged="SearchTextBox_TextChanged"/>
                </Grid>
            </Border>

            <!-- Các Icon và Avatar bên phải -->
            <StackPanel Grid.Column="2" Orientation="Horizontal" HorizontalAlignment="Right" VerticalAlignment="Center">
                <Button Width="40" Height="40" Style="{StaticResource TopbarButtonStyle}" Click="SettingsButton_Click" ToolTip="Chat AI">
                    <Path Data="M19 11h-1V8c0-3.31-2.69-6-6-6S6 4.69 6 8v3H5c-1.1 0-2 .9-2 2v3c0 2.21 1.79 4 4 4h1v2h2v-2h6v2h2v-2h1c2.21 0 4-1.79 4-4v-3c0-1.1-.9-2-2-2zM8 8c0-2.21 1.79-4 4-4s4 1.79 4 4v3H8V8zm1 6.5c-.83 0-1.5-.67-1.5-1.5S8.17 11 9 11s1.5.67 1.5 1.5S9.83 14.5 9 14.5zm6 0c-.83 0-1.5-.67-1.5-1.5S14.17 11 15 11s1.5.67 1.5 1.5S15.83 14.5 15 14.5z" 
                          Fill="#586A84" Stretch="Uniform" Width="20"/>
                </Button>

                <!-- Nút Avatar và Popup -->
                <ToggleButton x:Name="ProfileButton" Width="40" Height="40" Margin="10,0,0,0" Background="Transparent" BorderThickness="0" Cursor="Hand">
                    <Ellipse Width="40" Height="40">
                        <Ellipse.Fill>
                            <ImageBrush ImageSource="pack://application:,,,/QLKDPhongTro.Presentation;component/Resources/Images/avatar.jpg"/>
                        </Ellipse.Fill>
                    </Ellipse>
                </ToggleButton>

                <Popup x:Name="ProfilePopup"
                       IsOpen="{Binding IsChecked, ElementName=ProfileButton}" 
                       StaysOpen="False" 
                       PlacementTarget="{Binding ElementName=ProfileButton}"
                       Placement="Bottom"
                       AllowsTransparency="True"
                       PopupAnimation="Fade"
                       Opened="ProfilePopup_Opened">
                    <windows:ProfileDropDown x:Name="ProfileDropDownControl" Margin="0,10,0,0"/>
                </Popup>
            </StackPanel>
        </Grid>
    </Border>
</UserControl>