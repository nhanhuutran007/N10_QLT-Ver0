<Window x:Class="QLKDPhongTro.Presentation.Views.Windows.AddContractWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:converters="clr-namespace:QLKDPhongTro.Presentation.Converters"
        Title="Thêm hợp đồng"
        Height="650"
        Width="700"
        WindowStartupLocation="CenterOwner"
        ResizeMode="CanResize"
        Background="#F8FAFC"
        FontFamily="Segoe UI"
        TextOptions.TextFormattingMode="Display"
        TextOptions.TextRenderingMode="ClearType"
        Icon="/Resources/Images/Logo.png">
    <Window.Resources>
        <converters:NumberFormatConverter x:Key="NumberFormatConverter"/>
        <SolidColorBrush x:Key="PrimaryColor" Color="#10B981"/>
        <SolidColorBrush x:Key="PrimaryDarkColor" Color="#059669"/>
        <SolidColorBrush x:Key="SecondaryColor" Color="#3B82F6"/>
        <SolidColorBrush x:Key="SecondaryDarkColor" Color="#2563EB"/>
        <SolidColorBrush x:Key="TextPrimary" Color="#1F2937"/>
        <SolidColorBrush x:Key="TextSecondary" Color="#6B7280"/>
        <SolidColorBrush x:Key="TextTertiary" Color="#9CA3AF"/>
        <SolidColorBrush x:Key="BackgroundLight" Color="#FFFFFF"/>
        <SolidColorBrush x:Key="BackgroundLighter" Color="#F9FAFB"/>
        <SolidColorBrush x:Key="BorderColor" Color="#E5E7EB"/>
        <SolidColorBrush x:Key="BorderLightColor" Color="#F3F4F6"/>
        <SolidColorBrush x:Key="ErrorColor" Color="#EF4444"/>

        <DropShadowEffect x:Key="CardShadow" Color="#000000" Opacity="0.06" ShadowDepth="2" BlurRadius="12" Direction="270"/>
        <DropShadowEffect x:Key="HoverShadow" Color="#000000" Opacity="0.12" ShadowDepth="4" BlurRadius="16" Direction="270"/>
        <DropShadowEffect x:Key="ButtonShadow" Color="#000000" Opacity="0.1" ShadowDepth="1" BlurRadius="4" Direction="270"/>

        <Style x:Key="LabelStyle" TargetType="TextBlock">
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Foreground" Value="{StaticResource TextPrimary}"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="Margin" Value="0,16,0,8"/>
        </Style>

        <Style x:Key="InputFieldStyle" TargetType="TextBox">
            <Setter Property="Padding" Value="12,0"/>
            <Setter Property="Background" Value="White"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="BorderBrush" Value="{StaticResource BorderColor}"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="Foreground" Value="{StaticResource TextPrimary}"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="TextBox">
                        <Border x:Name="Border" 
                                CornerRadius="8" 
                                Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}">
                            <ScrollViewer x:Name="PART_ContentHost" 
                                            Margin="{TemplateBinding Padding}"
                                            VerticalAlignment="{TemplateBinding VerticalContentAlignment}"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsFocused" Value="True">
                                <Setter TargetName="Border" Property="BorderBrush" Value="{StaticResource SecondaryColor}"/>
                                <Setter TargetName="Border" Property="Effect" Value="{StaticResource ButtonShadow}"/>
                            </Trigger>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Border" Property="BorderBrush" Value="{StaticResource SecondaryColor}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="ComboBoxStyle" TargetType="ComboBox">
            <Setter Property="Padding" Value="12,10"/>
            <Setter Property="Background" Value="White"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="BorderBrush" Value="{StaticResource BorderColor}"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="Foreground" Value="{StaticResource TextPrimary}"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ComboBox">
                        <Border x:Name="border" 
                                CornerRadius="8"
                                Background="{TemplateBinding Background}" 
                                BorderBrush="{TemplateBinding BorderBrush}" 
                                BorderThickness="{TemplateBinding BorderThickness}">
                            <Grid>
                                <ToggleButton Name="ToggleButton" 
                                            Template="{DynamicResource ComboBoxToggleButton}" 
                                            Focusable="false" 
                                            IsChecked="{Binding Path=IsDropDownOpen, Mode=TwoWay, RelativeSource={RelativeSource TemplatedParent}}" 
                                            ClickMode="Press"/>
                                <ContentPresenter Name="ContentSite" 
                                                IsHitTestVisible="False"  
                                                Content="{TemplateBinding SelectionBoxItem}" 
                                                ContentTemplate="{TemplateBinding SelectionBoxItemTemplate}" 
                                                ContentTemplateSelector="{TemplateBinding ItemTemplateSelector}" 
                                                Margin="12,0,30,0" 
                                                VerticalAlignment="Center" 
                                                HorizontalAlignment="Left" />
                                <Popup Name="Popup" 
                                       Placement="Bottom" 
                                       IsOpen="{TemplateBinding IsDropDownOpen}" 
                                       AllowsTransparency="True" 
                                       Focusable="False" 
                                       PopupAnimation="Slide">
                                    <Grid Name="DropDown" 
                                          SnapsToDevicePixels="True" 
                                          MinWidth="{TemplateBinding ActualWidth}" 
                                          MaxHeight="{TemplateBinding MaxDropDownHeight}">
                                        <Border x:Name="DropDownBorder" 
                                                Background="White" 
                                                BorderThickness="1" 
                                                BorderBrush="{StaticResource BorderColor}" 
                                                CornerRadius="8" 
                                                Effect="{StaticResource CardShadow}" 
                                                Margin="0,2,0,0">
                                            <ScrollViewer Margin="4,6,4,6" SnapsToDevicePixels="True">
                                                <StackPanel IsItemsHost="True" KeyboardNavigation.DirectionalNavigation="Contained" />
                                            </ScrollViewer>
                                        </Border>
                                    </Grid>
                                </Popup>
                            </Grid>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="BorderBrush" Value="{StaticResource SecondaryColor}"/>
                            </Trigger>
                            <Trigger Property="IsDropDownOpen" Value="True">
                                <Setter TargetName="border" Property="BorderBrush" Value="{StaticResource SecondaryColor}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <ControlTemplate x:Key="ComboBoxToggleButton" TargetType="{x:Type ToggleButton}">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition />
                    <ColumnDefinition Width="20" />
                </Grid.ColumnDefinitions>
                <Border x:Name="Border" Grid.ColumnSpan="2" CornerRadius="8" Background="Transparent" BorderBrush="Transparent" BorderThickness="0" />
                <Path x:Name="Arrow" Grid.Column="1" Fill="{StaticResource TextSecondary}" HorizontalAlignment="Center" VerticalAlignment="Center" Data="M 0 0 L 4 4 L 8 0 Z"/>
            </Grid>
        </ControlTemplate>

        <Style TargetType="{x:Type ComboBoxItem}">
            <Setter Property="SnapsToDevicePixels" Value="True"/>
            <Setter Property="OverridesDefaultStyle" Value="True"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type ComboBoxItem}">
                        <Border Name="Border"
                                Padding="12,10"
                                Background="Transparent">
                            <ContentPresenter/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsHighlighted" Value="True">
                                <Setter TargetName="Border" Property="Background" Value="#F0F9FF"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style TargetType="DatePicker">
            <Setter Property="Padding" Value="12,10"/>
            <Setter Property="Background" Value="White"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="BorderBrush" Value="{StaticResource BorderColor}"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="Foreground" Value="{StaticResource TextPrimary}"/>
        </Style>

        <Style TargetType="Button" x:Key="PrimaryButtonStyle">
            <Setter Property="Background" Value="{StaticResource SecondaryColor}"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Height" Value="42"/>
            <Setter Property="Padding" Value="24,0"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="ButtonBorder" 
                                CornerRadius="8" 
                                Background="{TemplateBinding Background}" 
                                Effect="{StaticResource ButtonShadow}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="ButtonBorder" Property="Background" Value="{StaticResource SecondaryDarkColor}"/>
                                <Setter TargetName="ButtonBorder" Property="Effect" Value="{StaticResource HoverShadow}"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="ButtonBorder" Property="Opacity" Value="0.9"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style TargetType="Button" x:Key="SecondaryButtonStyle">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="{StaticResource TextSecondary}"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="FontWeight" Value="Medium"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Height" Value="42"/>
            <Setter Property="Padding" Value="16,0"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="ButtonBorder" Background="{TemplateBinding Background}" CornerRadius="8">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="ButtonBorder" Property="Background" Value="{StaticResource BackgroundLighter}"/>
                                <Setter Property="Foreground" Value="{StaticResource TextPrimary}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style TargetType="Button" x:Key="IconButtonStyle">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Foreground" Value="{StaticResource TextSecondary}"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="{StaticResource BackgroundLighter}"/>
                    <Setter Property="Foreground" Value="{StaticResource TextPrimary}"/>
                </Trigger>
            </Style.Triggers>
        </Style>
    </Window.Resources>

    <Grid Background="{StaticResource BackgroundLighter}">
        <Border CornerRadius="16" 
                Background="White" 
                Margin="20"
                Effect="{StaticResource CardShadow}">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <Border Grid.Row="0" 
                        Background="{StaticResource BackgroundLighter}" 
                        BorderThickness="0,0,0,1" 
                        BorderBrush="{StaticResource BorderColor}"
                        Padding="24,20">
                    <Grid>
                        <StackPanel>
                            <TextBlock Text="{Binding FormTitle}"
                                       FontSize="24"
                                       FontWeight="Bold"
                                       Foreground="{StaticResource TextPrimary}"/>
                            <TextBlock Text="Nhập thông tin hợp đồng thuê phòng"
                                       FontSize="14"
                                       Foreground="{StaticResource TextSecondary}"
                                       Margin="0,4,0,0"/>
                        </StackPanel>
                        <Button HorizontalAlignment="Right"
                                VerticalAlignment="Top"
                                Width="36"
                                Height="36"
                                Style="{StaticResource IconButtonStyle}"
                                ToolTip="Đóng"
                                Command="{Binding CancelCommand}">
                            <TextBlock Text="✕"
                                       FontSize="18"
                                       VerticalAlignment="Center"
                                       HorizontalAlignment="Center"/>
                        </Button>
                    </Grid>
                </Border>

                <ScrollViewer Grid.Row="1" 
                              VerticalScrollBarVisibility="Auto" 
                              Padding="24,20">
                    <StackPanel>
                        <TextBlock Text="Người thuê *" Style="{StaticResource LabelStyle}"/>
                        <ComboBox Style="{StaticResource ComboBoxStyle}"
                                  Height="44"
                                  ItemsSource="{Binding NguoiThueList}"
                                  DisplayMemberPath="HoTen"
                                  SelectedItem="{Binding SelectedNguoiThue, Mode=TwoWay}"/>

                        <TextBlock Text="Phòng *" Style="{StaticResource LabelStyle}"/>
                        <ComboBox Style="{StaticResource ComboBoxStyle}"
                                  Height="44"
                                  ItemsSource="{Binding PhongList}"
                                  DisplayMemberPath="TenPhong"
                                  SelectedItem="{Binding SelectedPhong, Mode=TwoWay}"/>

                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="20"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <StackPanel Grid.Column="0">
                                <TextBlock Text="Ngày bắt đầu *" Style="{StaticResource LabelStyle}"/>
                                <DatePicker SelectedDate="{Binding NgayBatDau}"
                                            Height="44"/>
                            </StackPanel>

                            <StackPanel Grid.Column="2">
                                <TextBlock Text="Ngày kết thúc *" Style="{StaticResource LabelStyle}"/>
                                <DatePicker SelectedDate="{Binding NgayKetThuc}"
                                            Height="44"/>
                            </StackPanel>
                        </Grid>

                        <TextBlock Text="Tiền cọc" Style="{StaticResource LabelStyle}"/>

                        <TextBox Style="{StaticResource InputFieldStyle}" 
                                 Height="44"
                                 Text="{Binding TienCoc, Mode=TwoWay, Converter={StaticResource NumberFormatConverter}, UpdateSourceTrigger=PropertyChanged}"/>

                        <TextBlock Text="Điều khoản riêng (tùy chọn)" Style="{StaticResource LabelStyle}"/>
                        <TextBox Style="{StaticResource InputFieldStyle}" 
                                 Height="100" 
                                 AcceptsReturn="True" 
                                 TextWrapping="Wrap"
                                 VerticalContentAlignment="Top"
                                 Padding="12,10"
                                 Text="{Binding DieuKhoanRieng, Mode=TwoWay}"/>

                        <TextBlock Text="Nơi lưu hợp đồng" Style="{StaticResource LabelStyle}"/>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <TextBox Grid.Column="0"
                                     Style="{StaticResource InputFieldStyle}"
                                     Height="44"
                                     IsReadOnly="True"
                                     Text="{Binding ContractSavePath, Mode=TwoWay}"
                                     ToolTip="{Binding ContractSavePath}">
                                <TextBox.ContextMenu>
                                    <ContextMenu>
                                        <MenuItem Header="Sao chép đường dẫn" 
                                                  Click="CopyPathMenuItem_Click"/>
                                    </ContextMenu>
                                </TextBox.ContextMenu>
                            </TextBox>
                            <Button Grid.Column="1"
                                    Content="Chọn nơi lưu"
                                    Margin="12,0,0,0"
                                    Height="44"
                                    Padding="16,0"
                                    Style="{StaticResource PrimaryButtonStyle}"
                                    Command="{Binding SelectSavePathCommand}"/>
                        </Grid>
                    </StackPanel>
                </ScrollViewer>

                <Border Grid.Row="2" 
                        Background="{StaticResource BackgroundLighter}" 
                        BorderThickness="0,1,0,0" 
                        BorderBrush="{StaticResource BorderColor}"
                        Padding="24,20">
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                        <Button Content="Hủy"
                                Style="{StaticResource SecondaryButtonStyle}"
                                Margin="0,0,12,0"
                                IsCancel="True"
                                Command="{Binding CancelCommand}"/>

                        <Button Content="Lưu"
                                Style="{StaticResource PrimaryButtonStyle}"
                                Width="120"
                                IsDefault="True"
                                Command="{Binding SaveCommand}"/>
                    </StackPanel>
                </Border>
            </Grid>
        </Border>
    </Grid>
</Window>