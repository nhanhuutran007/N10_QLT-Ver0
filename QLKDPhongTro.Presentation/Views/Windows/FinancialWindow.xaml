<Window x:Class="QLKDPhongTro.Presentation.Views.Windows.FinancialWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:components="clr-namespace:QLKDPhongTro.Presentation.Views.Components"
        xmlns:local="clr-namespace:QLKDPhongTro.Presentation.Views.Windows"
        xmlns:converters="clr-namespace:QLKDPhongTro.Presentation.Converters"
        xmlns:sys="clr-namespace:System;assembly=mscorlib"
        Title="Qu·∫£n l√Ω t√†i ch√≠nh - Qu·∫£n L√Ω Ph√≤ng Tr·ªç"
        MinHeight="600"
        MinWidth="800"
        Height="700"
        Width="1200"
        WindowStartupLocation="CenterScreen"
        ResizeMode="CanResize"
        Background="#F8FAFC"
        FontFamily="Segoe UI"
        Icon="/Resources/Images/Logo.png">

    <Window.Resources>
        <!-- Converters -->
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
        <converters:PageNumberEqualsConverter x:Key="PageNumberEqualsConverter"/>

        <!-- === STYLES C·∫¢I TI·∫æN HI·ªÜN ƒê·∫†I === -->

        <!-- Color palette hi·ªán ƒë·∫°i -->
        <SolidColorBrush x:Key="PrimaryColor" Color="#10B981"/>
        <SolidColorBrush x:Key="PrimaryDarkColor" Color="#059669"/>
        <SolidColorBrush x:Key="SecondaryColor" Color="#3B82F6"/>
        <SolidColorBrush x:Key="SecondaryDarkColor" Color="#2563EB"/>
        <SolidColorBrush x:Key="AccentColor" Color="#8B5CF6"/>
        <SolidColorBrush x:Key="WarningColor" Color="#F59E0B"/>
        <SolidColorBrush x:Key="ErrorColor" Color="#EF4444"/>
        <SolidColorBrush x:Key="TextPrimary" Color="#1F2937"/>
        <SolidColorBrush x:Key="TextSecondary" Color="#6B7280"/>
        <SolidColorBrush x:Key="TextTertiary" Color="#9CA3AF"/>
        <SolidColorBrush x:Key="BackgroundLight" Color="#FFFFFF"/>
        <SolidColorBrush x:Key="BackgroundLighter" Color="#F9FAFB"/>
        <SolidColorBrush x:Key="BackgroundCard" Color="#FFFFFF"/>
        <SolidColorBrush x:Key="BorderColor" Color="#E5E7EB"/>
        <SolidColorBrush x:Key="BorderLightColor" Color="#F3F4F6"/>

        <!-- Gradient brushes -->
        <LinearGradientBrush x:Key="PrimaryGradient" StartPoint="0,0" EndPoint="1,1">
            <GradientStop Color="#10B981" Offset="0"/>
            <GradientStop Color="#059669" Offset="1"/>
        </LinearGradientBrush>

        <LinearGradientBrush x:Key="SecondaryGradient" StartPoint="0,0" EndPoint="1,1">
            <GradientStop Color="#3B82F6" Offset="0"/>
            <GradientStop Color="#2563EB" Offset="1"/>
        </LinearGradientBrush>

        <LinearGradientBrush x:Key="RedGradient" StartPoint="0,0" EndPoint="1,1">
            <GradientStop Color="#EF4444" Offset="0"/>
            <GradientStop Color="#DC2626" Offset="1"/>
        </LinearGradientBrush>

        <LinearGradientBrush x:Key="OrangeGradient" StartPoint="0,0" EndPoint="1,1">
            <GradientStop Color="#F59E0B" Offset="0"/>
            <GradientStop Color="#D97706" Offset="1"/>
        </LinearGradientBrush>

        <!-- Shadow effects -->
        <DropShadowEffect x:Key="CardShadow" Color="#000000" Opacity="0.08" ShadowDepth="0" BlurRadius="20" Direction="0"/>
        <DropShadowEffect x:Key="HoverShadow" Color="#000000" Opacity="0.12" ShadowDepth="0" BlurRadius="25" Direction="0"/>
        <DropShadowEffect x:Key="ButtonShadow" Color="#000000" Opacity="0.15" ShadowDepth="0" BlurRadius="10" Direction="0"/>

        <!-- Style cho n√∫t h√†nh ƒë·ªông ch√≠nh -->
        <Style TargetType="{x:Type Button}" x:Key="ModernPrimaryButton">
            <Setter Property="Background" Value="{StaticResource SecondaryGradient}"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Height" Value="42"/>
            <Setter Property="Padding" Value="24,0"/>
            <Setter Property="Effect" Value="{StaticResource ButtonShadow}"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type Button}">
                        <Border x:Name="Border" 
                                CornerRadius="8"
                                Background="{TemplateBinding Background}">
                            <ContentPresenter HorizontalAlignment="Center"
                                              VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Border" Property="Background" Value="{StaticResource SecondaryDarkColor}"/>
                                <Setter Property="Effect" Value="{StaticResource HoverShadow}"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="Border" Property="Background" Value="#1D4ED8"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Style ri√™ng cho n√∫t Qu√©t ·∫¢nh -->
        <Style TargetType="{x:Type Button}" x:Key="ScanButtonStyle" BasedOn="{StaticResource ModernPrimaryButton}">
            <Setter Property="Background" Value="{StaticResource PrimaryGradient}"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="{StaticResource PrimaryDarkColor}"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- Style ri√™ng cho n√∫t X·ª≠ l√Ω c√¥ng n·ª£ t·ª´ Google Form -->
        <Style TargetType="{x:Type Button}" x:Key="GoogleFormButtonStyle" BasedOn="{StaticResource ModernPrimaryButton}">
            <Setter Property="Background" Value="{StaticResource AccentColor}"/>
            <Setter Property="Foreground" Value="White"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#7C3AED"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- Style cho n√∫t Segment hi·ªán ƒë·∫°i -->
        <Style TargetType="{x:Type Button}" x:Key="ModernSegmentButton">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="{StaticResource TextSecondary}"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="FontWeight" Value="Medium"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Height" Value="38"/>
            <Setter Property="Padding" Value="20,0"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type Button}">
                        <Border x:Name="Border" 
                                CornerRadius="8"
                                Background="{TemplateBinding Background}">
                            <ContentPresenter HorizontalAlignment="Center"
                                              VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Border" Property="Background" Value="#F3F4F6"/>
                                <Setter Property="Foreground" Value="{StaticResource TextPrimary}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Style cho n√∫t Segment ƒëang ACTIVE -->
        <Style TargetType="{x:Type Button}" x:Key="ModernActiveSegmentButton">
            <Setter Property="Background" Value="{StaticResource TextPrimary}"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="FontWeight" Value="Medium"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Height" Value="38"/>
            <Setter Property="Padding" Value="20,0"/>
            <Setter Property="Effect" Value="{StaticResource ButtonShadow}"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type Button}">
                        <Border x:Name="Border" 
                                CornerRadius="8"
                                Background="{TemplateBinding Background}">
                            <ContentPresenter HorizontalAlignment="Center"
                                              VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Border" Property="Background" Value="#374151"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Style c·∫£i ti·∫øn cho ComboBox -->
        <Style TargetType="{x:Type ComboBox}" x:Key="ModernComboBox">
            <Setter Property="Background" Value="{StaticResource BackgroundLight}"/>
            <Setter Property="Foreground" Value="{StaticResource TextPrimary}"/>
            <Setter Property="BorderBrush" Value="{StaticResource BorderColor}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="Padding" Value="12,0"/>
            <Setter Property="Height" Value="40"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Effect" Value="{StaticResource ButtonShadow}"/>
        </Style>

        <!-- Style c·∫£i ti·∫øn cho th·∫ª t√†i ch√≠nh -->
        <Style TargetType="{x:Type Border}" x:Key="ModernFinanceCard">
            <Setter Property="Background" Value="{StaticResource BackgroundCard}"/>
            <Setter Property="CornerRadius" Value="12"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="BorderBrush" Value="{StaticResource BorderLightColor}"/>
            <Setter Property="Margin" Value="8"/>
            <Setter Property="Effect" Value="{StaticResource CardShadow}"/>
        </Style>

        <!-- Style c·∫£i ti·∫øn cho Search Box -->
        <Style TargetType="{x:Type TextBox}" x:Key="ModernSearchBox">
            <Setter Property="Background" Value="{StaticResource BackgroundLighter}"/>
            <Setter Property="Foreground" Value="{StaticResource TextPrimary}"/>
            <Setter Property="BorderBrush" Value="{StaticResource BorderColor}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="Padding" Value="12,10"/>
            <Setter Property="Height" Value="40"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
            <Setter Property="Effect" Value="{StaticResource ButtonShadow}"/>
        </Style>

        <!-- Style cho statistic cards -->
        <Style TargetType="{x:Type Border}" x:Key="ModernStatCard">
            <Setter Property="Background" Value="{StaticResource BackgroundCard}"/>
            <Setter Property="CornerRadius" Value="12"/>
            <Setter Property="Padding" Value="24"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="BorderBrush" Value="{StaticResource BorderLightColor}"/>
            <Setter Property="Effect" Value="{StaticResource CardShadow}"/>
        </Style>

        <!-- Style cho section headers -->
        <Style TargetType="{x:Type TextBlock}" x:Key="ModernSectionHeader">
            <Setter Property="Foreground" Value="{StaticResource TextPrimary}"/>
            <Setter Property="FontSize" Value="26"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Margin" Value="0,0,0,24"/>
        </Style>

        <!-- Style cho pagination -->
        <Style TargetType="{x:Type Border}" x:Key="ModernPaginationContainer">
            <Setter Property="Background" Value="{StaticResource BackgroundLighter}"/>
            <Setter Property="CornerRadius" Value="10"/>
            <Setter Property="Padding" Value="20,16"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="BorderBrush" Value="{StaticResource BorderLightColor}"/>
            <Setter Property="Effect" Value="{StaticResource CardShadow}"/>
        </Style>

        <!-- Style cho progress bar hi·ªán ƒë·∫°i -->
        <Style TargetType="{x:Type ProgressBar}" x:Key="ModernProgressBar">
            <Setter Property="Height" Value="6"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Background" Value="#F3F4F6"/>
            <Setter Property="Foreground" Value="{StaticResource SecondaryColor}"/>
        </Style>

    </Window.Resources>

    <Grid Background="{StaticResource BackgroundLighter}">
        <Grid.ColumnDefinitions>
            <!-- Sidebar -->
            <ColumnDefinition Width="269" MinWidth="250"/>
            <!-- Main Content -->
            <ColumnDefinition/>
        </Grid.ColumnDefinitions>

        <!-- === SIDEBAR CONTROL === -->
        <components:SidebarControl Grid.Column="0" x:Name="SidebarControl"/>

        <!-- === KHU V·ª∞C N·ªòI DUNG CH√çNH - THI·∫æT K·∫æ HI·ªÜN ƒê·∫†I === -->
        <Grid Grid.Column="1" Margin="24">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!-- HEADER SECTION HI·ªÜN ƒê·∫†I -->
            <StackPanel Grid.Row="0">
                <!-- Top Bar -->
                <components:TopbarControl x:Name="TopbarControl" Height="50" Margin="0,0,0,24"/>

                <!-- Th·ªëng k√™ t·ªïng quan - Layout hi·ªán ƒë·∫°i -->
                <Grid Margin="0,0,0,32">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <!-- T·ªïng thu nh·∫≠p -->
                    <Border Style="{StaticResource ModernStatCard}" Grid.Column="0" Margin="0,0,8,0">
                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                            <Border Background="{StaticResource PrimaryGradient}" 
                                    Width="52" Height="52" CornerRadius="12" 
                                    Margin="0,0,16,0" VerticalAlignment="Center"
                                    Effect="{StaticResource ButtonShadow}">
                                <Viewbox Width="24" Height="24" Margin="2">
                                    <TextBlock Text="üí∞" FontSize="16" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                </Viewbox>
                            </Border>
                            <StackPanel>
                                <TextBlock Text="T·ªïng thu nh·∫≠p" 
                                          Foreground="{StaticResource TextSecondary}" 
                                          FontSize="14" 
                                          FontWeight="Medium"/>
                                <TextBlock Text="{Binding TotalRevenue, StringFormat='{}{0:N0} VNƒê'}" 
                                          Foreground="{StaticResource TextPrimary}" 
                                          FontSize="18" 
                                          FontWeight="Bold" 
                                          Margin="0,4,0,0"/>
                            </StackPanel>
                        </StackPanel>
                    </Border>

                    <!-- T·ªïng chi ph√≠ -->
                    <Border Style="{StaticResource ModernStatCard}" Grid.Column="1" Margin="4,0,4,0">
                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                            <Border Background="{StaticResource RedGradient}" 
                                    Width="52" Height="52" CornerRadius="12" 
                                    Margin="0,0,16,0" VerticalAlignment="Center"
                                    Effect="{StaticResource ButtonShadow}">
                                <Viewbox Width="24" Height="24" Margin="2">
                                    <TextBlock Text="üí∏" FontSize="16" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                </Viewbox>
                            </Border>
                            <StackPanel>
                                <TextBlock Text="T·ªïng chi ph√≠" 
                                          Foreground="{StaticResource TextSecondary}" 
                                          FontSize="14" 
                                          FontWeight="Medium"/>
                                <TextBlock Text="{Binding TotalExpense, StringFormat='{}{0:N0} VNƒê'}" 
                                          Foreground="{StaticResource TextPrimary}" 
                                          FontSize="18" 
                                          FontWeight="Bold" 
                                          Margin="0,4,0,0"/>
                            </StackPanel>
                        </StackPanel>
                    </Border>

                    <!-- L·ª£i nhu·∫≠n -->
                    <Border Style="{StaticResource ModernStatCard}" Grid.Column="2" Margin="4,0,4,0">
                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                            <Border Background="{StaticResource SecondaryGradient}" 
                                    Width="52" Height="52" CornerRadius="12" 
                                    Margin="0,0,16,0" VerticalAlignment="Center"
                                    Effect="{StaticResource ButtonShadow}">
                                <Viewbox Width="24" Height="24" Margin="2">
                                    <TextBlock Text="üìà" FontSize="16" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                </Viewbox>
                            </Border>
                            <StackPanel>
                                <TextBlock Text="L·ª£i nhu·∫≠n" 
                                          Foreground="{StaticResource TextSecondary}" 
                                          FontSize="14" 
                                          FontWeight="Medium"/>
                                <TextBlock Text="{Binding TotalProfit, StringFormat='{}{0:N0} VNƒê'}" 
                                          Foreground="{StaticResource TextPrimary}" 
                                          FontSize="18" 
                                          FontWeight="Bold" 
                                          Margin="0,4,0,0"/>
                            </StackPanel>
                        </StackPanel>
                    </Border>

                    <!-- T·ªïng c√¥ng n·ª£ -->
                    <Border Style="{StaticResource ModernStatCard}" Grid.Column="3" Margin="8,0,0,0">
                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                            <Border Background="{StaticResource OrangeGradient}" 
                                    Width="52" Height="52" CornerRadius="12" 
                                    Margin="0,0,16,0" VerticalAlignment="Center"
                                    Effect="{StaticResource ButtonShadow}">
                                <Viewbox Width="24" Height="24" Margin="2">
                                    <TextBlock Text="‚è∞" FontSize="16" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                </Viewbox>
                            </Border>
                            <StackPanel>
                                <TextBlock Text="T·ªïng c√¥ng n·ª£" 
                                          Foreground="{StaticResource TextSecondary}" 
                                          FontSize="14" 
                                          FontWeight="Medium"/>
                                <TextBlock Text="{Binding TotalDebt, StringFormat='{}{0:N0} VNƒê'}" 
                                          Foreground="{StaticResource TextPrimary}" 
                                          FontSize="18" 
                                          FontWeight="Bold" 
                                          Margin="0,4,0,0"/>
                            </StackPanel>
                        </StackPanel>
                    </Border>
                </Grid>

                <!-- Ti√™u ƒë·ªÅ ch√≠nh -->
                <TextBlock Text="Qu·∫£n l√Ω t√†i ch√≠nh" Style="{StaticResource ModernSectionHeader}"/>

                <!-- CONTROL PANEL - Layout hi·ªán ƒë·∫°i -->
                <Border Style="{StaticResource ModernStatCard}" Margin="0,0,0,28">
                    <StackPanel>
                        <!-- Row 1: Navigation -->
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,20">
                            <TextBlock Text="Xem theo:" 
                                      Foreground="{StaticResource TextSecondary}" 
                                      VerticalAlignment="Center" 
                                      Margin="0,0,16,0" 
                                      FontWeight="SemiBold" 
                                      FontSize="15"/>

                            <Border Background="{StaticResource BackgroundLighter}" 
                                    CornerRadius="8" 
                                    Padding="4"
                                    Effect="{StaticResource ButtonShadow}">
                                <StackPanel Orientation="Horizontal">
                                    <Button Content="T·∫•t c·∫£ b·∫£n ghi" 
                                            Style="{StaticResource ModernActiveSegmentButton}"
                                            Click="ViewAllRecords_Click"/>
                                    <Button Content="Qu·∫£n l√Ω C√¥ng n·ª£" 
                                            Style="{StaticResource ModernSegmentButton}" 
                                            Margin="4,0,0,0"
                                            Click="ViewDebts_Click"/>
                                    <Button Content="B√°o c√°o Thu chi" 
                                            Style="{StaticResource ModernSegmentButton}" 
                                            Margin="4,0,0,0"
                                            Click="ViewReports_Click"/>
                                </StackPanel>
                            </Border>

                            <!-- N√∫t X·ª≠ l√Ω c√¥ng n·ª£ t·ª´ Google Form -->
                            <Button Content="üìä X·ª≠ l√Ω c√¥ng n·ª£ t·ª´ Google Form"
                                    Style="{StaticResource GoogleFormButtonStyle}"
                                    Command="{Binding ProcessDebtsFromGoogleFormCommand}"
                                    Margin="24,0,0,0"
                                    Height="38"
                                    Padding="20,0"
                                    ToolTip="T·ª± ƒë·ªông x·ª≠ l√Ω c√¥ng n·ª£ t·ª´ d·ªØ li·ªáu Google Form"/>
                        </StackPanel>

                        <!-- Row 2: Search, Filter v√† Actions -->
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <!-- Left: Search v√† Filters -->
                            <StackPanel Grid.Column="0" Orientation="Horizontal">
                                <!-- Search Box -->
                                <TextBox x:Name="FinancialSearchTextBox"
                                         Style="{StaticResource ModernSearchBox}"
                                         Width="300"
                                         Margin="0,0,16,0"
                                         Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}">
                                    <TextBox.Resources>
                                        <Style TargetType="Border">
                                            <Setter Property="CornerRadius" Value="8"/>
                                        </Style>
                                    </TextBox.Resources>
                                </TextBox>

                                <!-- Sort v√† Filters -->
                                <StackPanel Orientation="Horizontal">
                                    <ComboBox Style="{StaticResource ModernComboBox}"
                                              Width="160"
                                              Margin="0,0,12,0"
                                              SelectedItem="{Binding SelectedSortOption}">
                                        <ComboBox.Resources>
                                            <Style TargetType="Border">
                                                <Setter Property="CornerRadius" Value="8"/>
                                            </Style>
                                        </ComboBox.Resources>
                                        <ComboBoxItem>M·ªõi nh·∫•t</ComboBoxItem>
                                        <ComboBoxItem>C≈© nh·∫•t</ComboBoxItem>
                                        <ComboBoxItem>Theo S·ªë ti·ªÅn (Cao - Th·∫•p)</ComboBoxItem>
                                        <ComboBoxItem>Theo S·ªë ti·ªÅn (Th·∫•p - Cao)</ComboBoxItem>
                                    </ComboBox>

                                    <ComboBox Style="{StaticResource ModernComboBox}"
                                              Width="140"
                                              Margin="0,0,12,0"
                                              SelectedItem="{Binding SelectedFilterType}">
                                        <ComboBox.Resources>
                                            <Style TargetType="Border">
                                                <Setter Property="CornerRadius" Value="8"/>
                                            </Style>
                                        </ComboBox.Resources>
                                        <ComboBoxItem>T·∫•t c·∫£</ComboBoxItem>
                                        <ComboBoxItem>Ti·ªÅn Thu√™</ComboBoxItem>
                                        <ComboBoxItem>Chi Ph√≠</ComboBoxItem>
                                        <ComboBoxItem>Ch·ªâ S·ªë ƒêi·ªán/N∆∞·ªõc</ComboBoxItem>
                                    </ComboBox>

                                    <ComboBox Style="{StaticResource ModernComboBox}"
                                              Width="140"
                                              SelectedItem="{Binding SelectedFilterStatus}">
                                        <ComboBox.Resources>
                                            <Style TargetType="Border">
                                                <Setter Property="CornerRadius" Value="8"/>
                                            </Style>
                                        </ComboBox.Resources>
                                        <ComboBoxItem>T·∫•t c·∫£</ComboBoxItem>
                                        <ComboBoxItem>Ho√†n th√†nh</ComboBoxItem>
                                        <ComboBoxItem>B√¨nh th∆∞·ªùng</ComboBoxItem>
                                        <ComboBoxItem>C·∫£nh b√°o</ComboBoxItem>
                                        <ComboBoxItem>Qu√° h·∫°n</ComboBoxItem>
                                    </ComboBox>
                                </StackPanel>
                            </StackPanel>

                            <!-- Right: Primary Actions -->
                            <StackPanel Grid.Column="1" 
                                        Orientation="Horizontal" 
                                        HorizontalAlignment="Right"
                                        VerticalAlignment="Center">
                                <Button Content="Ghi nh·∫≠n Ti·ªÅn thu√™"
                                        Command="{Binding ManualInputRentCommand}"
                                        Style="{StaticResource ModernPrimaryButton}"
                                        Click="ManualInputButton_Click"/>
                                <Button Content="Qu√©t ·∫¢nh Ch·ªâ s·ªë"
                                        Style="{StaticResource ScanButtonStyle}"
                                        Command="{Binding ScanImageCommand}"
                                        Click="ScanImageButton_Click"
                                        Margin="12,0,0,0"/>
                            </StackPanel>
                        </Grid>
                    </StackPanel>
                </Border>
            </StackPanel>

            <!-- MAIN CONTENT AREA HI·ªÜN ƒê·∫†I -->
            <Grid Grid.Row="1">
                <!-- Loading Indicator hi·ªán ƒë·∫°i -->
                <Border Background="{StaticResource BackgroundCard}" 
                        CornerRadius="12"
                        Padding="32"
                        VerticalAlignment="Center"
                        HorizontalAlignment="Center"
                        Visibility="{Binding IsLoading, Converter={StaticResource BooleanToVisibilityConverter}}"
                        BorderThickness="1"
                        BorderBrush="{StaticResource BorderLightColor}"
                        Effect="{StaticResource CardShadow}">
                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                        <ProgressBar IsIndeterminate="True" 
                                     Width="24" 
                                     Height="24" 
                                     Margin="0,0,16,0"
                                     Foreground="{StaticResource SecondaryColor}"
                                     Style="{StaticResource ModernProgressBar}"/>
                        <TextBlock Text="ƒêang t·∫£i d·ªØ li·ªáu..." 
                                  FontSize="15" 
                                  Foreground="{StaticResource TextSecondary}" 
                                  VerticalAlignment="Center"
                                  FontWeight="Medium"/>
                    </StackPanel>
                </Border>

                <!-- === VIEW: T·∫§T C·∫¢ B·∫¢N GHI === -->
                <ScrollViewer VerticalScrollBarVisibility="Auto"
                              HorizontalScrollBarVisibility="Disabled"
                              Visibility="{Binding IsAllRecordsView, Converter={StaticResource BooleanToVisibilityConverter}}"
                              Padding="2">
                    <StackPanel>
                        <!-- Danh s√°ch b·∫£n ghi d·∫°ng l∆∞·ªõi -->
                        <ItemsControl ItemsSource="{Binding FinancialRecords}" Margin="0,0,0,20">
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <WrapPanel Orientation="Horizontal"/>
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Border Style="{StaticResource ModernFinanceCard}"
                                            Width="340"
                                            MouseEnter="Card_MouseEnter"
                                            MouseLeave="Card_MouseLeave"
                                            Tag="{Binding DataContext, RelativeSource={RelativeSource AncestorType=Window}}"
                                            Cursor="Hand">
                                        <Border.ContextMenu>
                                            <ContextMenu>
                                                <MenuItem Header="Xem chi ti·∫øt" 
                                                          Command="{Binding PlacementTarget.Tag.ViewDetailCommand, RelativeSource={RelativeSource AncestorType=ContextMenu}}"
                                                          CommandParameter="{Binding PlacementTarget.DataContext, RelativeSource={RelativeSource AncestorType=ContextMenu}}"/>
                                                <MenuItem Header="ƒê√°nh d·∫•u ƒë√£ tr·∫£" 
                                                          Command="{Binding PlacementTarget.Tag.MarkAsPaidCommand, RelativeSource={RelativeSource AncestorType=ContextMenu}}"
                                                          CommandParameter="{Binding PlacementTarget.DataContext, RelativeSource={RelativeSource AncestorType=ContextMenu}}"/>
                                                <Separator/>
                                                <MenuItem Header="Ch·ªânh s·ª≠a" 
                                                          Command="{Binding PlacementTarget.Tag.EditCommand, RelativeSource={RelativeSource AncestorType=ContextMenu}}"
                                                          CommandParameter="{Binding PlacementTarget.DataContext, RelativeSource={RelativeSource AncestorType=ContextMenu}}"/>
                                                <MenuItem Header="X√≥a" 
                                                          Command="{Binding PlacementTarget.Tag.DeleteCommand, RelativeSource={RelativeSource AncestorType=ContextMenu}}"
                                                          CommandParameter="{Binding PlacementTarget.DataContext, RelativeSource={RelativeSource AncestorType=ContextMenu}}"
                                                          Foreground="{StaticResource ErrorColor}"/>
                                            </ContextMenu>
                                        </Border.ContextMenu>

                                        <StackPanel>
                                            <!-- Card Header -->
                                            <Border Background="{StaticResource BackgroundLighter}"
                                                    Padding="20,16"
                                                    CornerRadius="12,12,0,0"
                                                    BorderThickness="0,0,0,1"
                                                    BorderBrush="{StaticResource BorderLightColor}">
                                                <Grid>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="Auto"/>
                                                    </Grid.ColumnDefinitions>

                                                    <StackPanel Grid.Column="0">
                                                        <TextBlock Text="{Binding TenPhong}"
                                                                  FontWeight="Bold"
                                                                  FontSize="16"
                                                                  Foreground="{StaticResource TextPrimary}"/>
                                                        <TextBlock Text="{Binding KyHan, StringFormat='K·ª≥: {0:MMM yyyy}'}"
                                                                  FontSize="13"
                                                                  Foreground="{StaticResource TextTertiary}"
                                                                  Margin="0,4,0,0"/>
                                                    </StackPanel>

                                                    <Border Grid.Column="1"
                                                            Background="{StaticResource BackgroundLighter}"
                                                            CornerRadius="6"
                                                            Padding="8,4"
                                                            HorizontalAlignment="Right"
                                                            VerticalAlignment="Center"
                                                            BorderThickness="1"
                                                            BorderBrush="{StaticResource BorderColor}"
                                                            Effect="{StaticResource ButtonShadow}">
                                                        <TextBlock Text="{Binding LoaiGiaoDich}"
                                                                  FontSize="12"
                                                                  Foreground="{StaticResource TextSecondary}"
                                                                  FontWeight="Medium"/>
                                                    </Border>
                                                </Grid>
                                            </Border>

                                            <!-- Card Content -->
                                            <StackPanel Margin="20" Grid.IsSharedSizeScope="True">
                                                <!-- Th√¥ng tin ch√≠nh -->
                                                <Grid Margin="0,0,0,16">
                                                    <Grid.RowDefinitions>
                                                        <RowDefinition Height="Auto"/>
                                                        <RowDefinition Height="Auto"/>
                                                    </Grid.RowDefinitions>

                                                    <!-- S·ªë ti·ªÅn -->
                                                    <StackPanel Grid.Row="0" Orientation="Horizontal" 
                                                               Margin="0,0,0,12">
                                                        <TextBlock Text="S·ªë ti·ªÅn:" 
                                                                  Foreground="{StaticResource TextSecondary}" 
                                                                  FontSize="14"
                                                                  Margin="0,0,8,0"/>
                                                        <TextBlock Text="{Binding TongTien, StringFormat='{}{0:N0} VNƒê'}"
                                                                  FontWeight="Bold"
                                                                  FontSize="16"
                                                                  Foreground="{StaticResource TextPrimary}"/>
                                                    </StackPanel>

                                                    <!-- Chi ti·∫øt v√† Tr·∫°ng th√°i -->
                                                    <Grid Grid.Row="1">
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="*" SharedSizeGroup="DetailColumn"/>
                                                            <ColumnDefinition Width="*" SharedSizeGroup="StatusColumn"/>
                                                        </Grid.ColumnDefinitions>

                                                        <StackPanel Grid.Column="0">
                                                            <TextBlock Text="Chi ti·∫øt" 
                                                                      Foreground="{StaticResource TextTertiary}" 
                                                                      FontSize="12"
                                                                      FontWeight="Medium"/>
                                                            <TextBlock Text="{Binding ChiTietGiaoDich}"
                                                                      FontSize="14"
                                                                      Foreground="{StaticResource TextPrimary}"
                                                                      Margin="0,4,0,0"
                                                                      TextTrimming="CharacterEllipsis"/>
                                                        </StackPanel>

                                                        <StackPanel Grid.Column="1" Margin="12,0,0,0">
                                                            <TextBlock Text="Tr·∫°ng th√°i" 
                                                                      Foreground="{StaticResource TextTertiary}" 
                                                                      FontSize="12"
                                                                      FontWeight="Medium"/>
                                                            <TextBlock Text="{Binding TrangThaiText}"
                                                                      FontSize="14"
                                                                      FontWeight="SemiBold"
                                                                      Foreground="{Binding TrangThaiColor}"
                                                                      Margin="0,4,0,0"/>
                                                        </StackPanel>
                                                    </Grid>
                                                </Grid>

                                                <!-- Progress Section -->
                                                <StackPanel>
                                                    <Grid Margin="0,0,0,8">
                                                        <TextBlock Text="Ti·∫øn ƒë·ªô" 
                                                                  Foreground="{StaticResource TextSecondary}" 
                                                                  FontSize="12"
                                                                  FontWeight="Medium"/>
                                                        <TextBlock Text="{Binding ProgressValue, StringFormat='{}{0}%'}"
                                                                  Foreground="{StaticResource TextSecondary}" 
                                                                  FontSize="12"
                                                                  HorizontalAlignment="Right"/>
                                                    </Grid>

                                                    <ProgressBar Style="{StaticResource ModernProgressBar}"
                                                                Value="{Binding ProgressValue}"
                                                                Margin="0,0,0,12"
                                                                Minimum="0"
                                                                Maximum="100"/>

                                                    <TextBlock Text="Xem chi ti·∫øt" 
                                                              Foreground="{StaticResource SecondaryColor}" 
                                                              FontSize="14"
                                                              FontWeight="Medium"
                                                              HorizontalAlignment="Right"
                                                              Cursor="Hand"
                                                              MouseLeftButtonDown="ViewDetail_MouseLeftButtonDown"/>
                                                </StackPanel>
                                            </StackPanel>
                                        </StackPanel>
                                    </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>

                        <!-- Pagination hi·ªán ƒë·∫°i -->
                        <Border Style="{StaticResource ModernPaginationContainer}">
                            <Grid>
                                <TextBlock Text="{Binding PageInfo}"
                                          VerticalAlignment="Center"
                                          HorizontalAlignment="Left"
                                          Foreground="{StaticResource TextSecondary}"
                                          FontSize="14"
                                          FontWeight="Medium"/>
                                <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                                    <Button Content="&lt; Tr∆∞·ªõc" 
                                            Style="{StaticResource ModernSegmentButton}" 
                                            Margin="0,0,8,0" 
                                            Height="36" 
                                            Padding="16,0"
                                            Command="{Binding PreviousPageCommand}"
                                            IsEnabled="{Binding CanGoToPreviousPage}"/>

                                    <StackPanel Orientation="Horizontal">
                                        <ItemsControl ItemsSource="{Binding PageNumbers}">
                                            <ItemsControl.ItemsPanel>
                                                <ItemsPanelTemplate>
                                                    <StackPanel Orientation="Horizontal"/>
                                                </ItemsPanelTemplate>
                                            </ItemsControl.ItemsPanel>
                                            <ItemsControl.ItemTemplate>
                                                <DataTemplate>
                                                    <Button Content="{Binding}" 
                                                            Margin="4,0,0,0" 
                                                            Height="36" 
                                                            Width="36" 
                                                            Padding="0"
                                                            Click="PageNumber_Click"
                                                            CommandParameter="{Binding}">
                                                        <Button.Style>
                                                            <Style TargetType="Button" BasedOn="{StaticResource ModernSegmentButton}">
                                                                <Setter Property="Background" Value="Transparent"/>
                                                                <Setter Property="Foreground" Value="{StaticResource TextSecondary}"/>
                                                                <Style.Triggers>
                                                                    <DataTrigger Binding="{Binding IsActive}" Value="True">
                                                                        <Setter Property="Background" Value="{StaticResource TextPrimary}"/>
                                                                        <Setter Property="Foreground" Value="White"/>
                                                                        <Setter Property="Effect" Value="{StaticResource ButtonShadow}"/>
                                                                    </DataTrigger>
                                                                </Style.Triggers>
                                                            </Style>
                                                        </Button.Style>
                                                    </Button>
                                                </DataTemplate>
                                            </ItemsControl.ItemTemplate>
                                        </ItemsControl>
                                    </StackPanel>

                                    <Button Content="Sau &gt;" 
                                            Style="{StaticResource ModernSegmentButton}" 
                                            Margin="8,0,0,0" 
                                            Height="36" 
                                            Padding="16,0"
                                            Command="{Binding NextPageCommand}"
                                            IsEnabled="{Binding CanGoToNextPage}"/>
                                </StackPanel>
                            </Grid>
                        </Border>
                    </StackPanel>
                </ScrollViewer>

                <!-- C√°c view kh√°c gi·ªØ nguy√™n logic nh∆∞ng √°p d·ª•ng style m·ªõi -->
                <!-- === VIEW: QU·∫¢N L√ù C√îNG N·ª¢ === -->
                <ScrollViewer VerticalScrollBarVisibility="Auto"
                              HorizontalScrollBarVisibility="Disabled"
                              Visibility="{Binding IsDebtsView, Converter={StaticResource BooleanToVisibilityConverter}}">
                    <StackPanel>
                        <Border Style="{StaticResource ModernStatCard}" Margin="0,0,0,10">
                            <StackPanel>
                                <TextBlock Text="Danh s√°ch c√¥ng n·ª£" 
                                          FontSize="20" 
                                          FontWeight="Bold" 
                                          Foreground="{StaticResource TextPrimary}" 
                                          Margin="0,0,0,20"/>
                                <!-- DataGrid content gi·ªØ nguy√™n logic -->
                                <DataGrid ItemsSource="{Binding Debts}"
                                          AutoGenerateColumns="False"
                                          CanUserAddRows="False"
                                          Background="White"
                                          BorderThickness="0"
                                          GridLinesVisibility="None"
                                          HeadersVisibility="Column"
                                          RowHeight="45"
                                          HorizontalAlignment="Stretch">
                                    <DataGrid.Columns>
                                        <DataGridTextColumn Header="Ph√≤ng" Binding="{Binding TenPhong}" Width="100"/>
                                        <DataGridTextColumn Header="Kh√°ch h√†ng" Binding="{Binding TenKhachHang}" Width="*"/>
                                        <DataGridTextColumn Header="Th√°ng/NƒÉm" Binding="{Binding ThangNam}" Width="100"/>
                                        <DataGridTextColumn Header="S·ªë ti·ªÅn" Binding="{Binding TongTien, StringFormat='{}{0:N0} VNƒê'}" Width="130"/>
                                        <DataGridTextColumn Header="S·ªë th√°ng n·ª£" Binding="{Binding SoThangNo}" Width="100"/>
                                        <DataGridTextColumn Header="Tr·∫°ng th√°i" Binding="{Binding TrangThaiThanhToan}" Width="120"/>
                                    </DataGrid.Columns>
                                </DataGrid>
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </ScrollViewer>

                <!-- === VIEW: B√ÅO C√ÅO THU CHI === -->
                <ScrollViewer VerticalScrollBarVisibility="Auto"
                              HorizontalScrollBarVisibility="Disabled"
                              Visibility="{Binding IsReportsView, Converter={StaticResource BooleanToVisibilityConverter}}">
                    <StackPanel>
                        <Border Style="{StaticResource ModernStatCard}" Margin="0,0,0,10">
                            <StackPanel>
                                <TextBlock Text="B√°o c√°o t√†i ch√≠nh" 
                                          FontSize="20" 
                                          FontWeight="Bold" 
                                          Foreground="{StaticResource TextPrimary}" 
                                          Margin="0,0,0,16"/>
                                <TextBlock Text="Th·ªëng k√™ theo th√°ng" 
                                          FontSize="15" 
                                          FontWeight="SemiBold" 
                                          Foreground="{StaticResource TextSecondary}" 
                                          Margin="0,0,0,12"/>
                                <TextBlock Text="D·ªØ li·ªáu th·ªëng k√™ s·∫Ω ƒë∆∞·ª£c hi·ªÉn th·ªã t·∫°i ƒë√¢y" 
                                          Foreground="{StaticResource TextTertiary}" 
                                          FontSize="14"
                                          FontStyle="Italic"/>
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </ScrollViewer>
            </Grid>
        </Grid>
    </Grid>
</Window>