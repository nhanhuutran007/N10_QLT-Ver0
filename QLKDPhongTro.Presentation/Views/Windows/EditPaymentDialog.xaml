<Window x:Class="QLKDPhongTro.Presentation.Views.Windows.EditPaymentDialog"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:converters="clr-namespace:QLKDPhongTro.Presentation.Converters"
    mc:Ignorable="d"
    Title="Chỉnh sửa thanh toán - Quản Lý Phòng Trọ"
    Height="650" Width="700"
    WindowStartupLocation="CenterOwner"
    ResizeMode="NoResize"
    WindowStyle="None"
    AllowsTransparency="True"
    Background="Transparent"
    FontFamily="Segoe UI"
    TextOptions.TextFormattingMode="Display"
    TextOptions.TextRenderingMode="ClearType"
    Icon="/Resources/Images/Logo.png"
    MouseLeftButtonDown="Window_MouseLeftButtonDown">

    <Window.Resources>
        <converters:NumberFormatConverter x:Key="NumberFormatConverter"/>
        
        <SolidColorBrush x:Key="PrimaryColor" Color="#10B981"/>
        <SolidColorBrush x:Key="PrimaryDarkColor" Color="#059669"/>
        <SolidColorBrush x:Key="SecondaryColor" Color="#3B82F6"/>
        <SolidColorBrush x:Key="SecondaryDarkColor" Color="#2563EB"/>
        <SolidColorBrush x:Key="TextPrimary" Color="#1F2937"/>
        <SolidColorBrush x:Key="TextSecondary" Color="#6B7280"/>
        <SolidColorBrush x:Key="BackgroundLight" Color="#FFFFFF"/>
        <SolidColorBrush x:Key="BackgroundLighter" Color="#F9FAFB"/>
        <SolidColorBrush x:Key="BorderColor" Color="#E5E7EB"/>

        <LinearGradientBrush x:Key="PrimaryGradient" StartPoint="0,0" EndPoint="1,1">
            <GradientStop Color="#10B981" Offset="0"/>
            <GradientStop Color="#059669" Offset="1"/>
        </LinearGradientBrush>
        <LinearGradientBrush x:Key="SecondaryGradient" StartPoint="0,0" EndPoint="1,1">
            <GradientStop Color="#3B82F6" Offset="0"/>
            <GradientStop Color="#2563EB" Offset="1"/>
        </LinearGradientBrush>

        <DropShadowEffect x:Key="CardShadow" Color="#000000" Opacity="0.06" ShadowDepth="2" BlurRadius="12" Direction="270"/>
        <DropShadowEffect x:Key="WindowShadow" Color="#000000" Opacity="0.15" ShadowDepth="8" BlurRadius="20" Direction="270"/>

        <Style TargetType="{x:Type Button}" x:Key="ModernPrimaryButton">
            <Setter Property="Background" Value="{StaticResource SecondaryGradient}"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Height" Value="42"/>
            <Setter Property="Padding" Value="20,0"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type Button}">
                        <Border x:Name="Border" CornerRadius="8" Background="{TemplateBinding Background}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Border" Property="Background" Value="{StaticResource SecondaryDarkColor}"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="Border" Property="Opacity" Value="0.9"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style TargetType="Button" x:Key="CloseButtonStyle">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Width" Value="32"/>
            <Setter Property="Height" Value="32"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="Border" Background="{TemplateBinding Background}" CornerRadius="6">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Border" Property="Background" Value="{StaticResource BackgroundLighter}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style TargetType="TextBox" x:Key="FormTextBoxStyle">
            <Setter Property="Height" Value="40"/>
            <Setter Property="Padding" Value="12,0"/>
            <Setter Property="Background" Value="{StaticResource BackgroundLight}"/>
            <Setter Property="BorderBrush" Value="{StaticResource BorderColor}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="TextBox">
                        <Border x:Name="Border" Background="{TemplateBinding Background}" 
                                BorderBrush="{TemplateBinding BorderBrush}" 
                                BorderThickness="{TemplateBinding BorderThickness}" 
                                CornerRadius="6">
                            <ScrollViewer x:Name="PART_ContentHost" Margin="{TemplateBinding Padding}"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsFocused" Value="True">
                                <Setter TargetName="Border" Property="BorderBrush" Value="{StaticResource SecondaryColor}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Window.Resources>

    <Border Background="White" CornerRadius="12" Margin="10" Effect="{StaticResource WindowShadow}">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- Header -->
            <Grid Grid.Row="0" Background="{StaticResource BackgroundLighter}" Height="60">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <TextBlock Grid.Column="0" Text="Chỉnh sửa thanh toán" 
                           FontSize="20" FontWeight="Bold" 
                           Foreground="{StaticResource TextPrimary}" 
                           VerticalAlignment="Center" Margin="24,0"/>
                <Button Grid.Column="1" Content="✕" Style="{StaticResource CloseButtonStyle}" 
                        Command="{Binding CancelCommand}" 
                        Margin="0,0,12,0" VerticalAlignment="Center"/>
            </Grid>

            <!-- Content -->
            <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" Padding="24">
                <StackPanel>
                    <!-- Info Section -->
                    <Border Background="{StaticResource BackgroundLighter}" CornerRadius="8" Padding="16" Margin="0,0,0,20">
                        <StackPanel>
                            <TextBlock Text="Thông tin thanh toán" FontWeight="SemiBold" FontSize="14" 
                                       Foreground="{StaticResource TextPrimary}" Margin="0,0,0,12"/>
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                <TextBlock Grid.Row="0" Grid.Column="0" Text="Phòng:" 
                                           Foreground="{StaticResource TextSecondary}" Margin="0,0,12,8"/>
                                <TextBlock Grid.Row="0" Grid.Column="1" Text="{Binding TenPhong}" 
                                           FontWeight="SemiBold" Foreground="{StaticResource TextPrimary}"/>
                                <TextBlock Grid.Row="1" Grid.Column="0" Text="Kỳ hạn:" 
                                           Foreground="{StaticResource TextSecondary}" Margin="0,0,12,0"/>
                                <TextBlock Grid.Row="1" Grid.Column="1" Text="{Binding ThangNam}" 
                                           FontWeight="SemiBold" Foreground="{StaticResource TextPrimary}"/>
                            </Grid>
                        </StackPanel>
                    </Border>

                    <!-- Form Fields -->
                    <TextBlock Text="Chi tiết thanh toán" FontWeight="SemiBold" FontSize="16" 
                               Foreground="{StaticResource TextPrimary}" Margin="0,0,0,16"/>

                    <!-- Tiền thuê -->
                    <TextBlock Text="Tiền thuê (VNĐ)" FontSize="13" 
                               Foreground="{StaticResource TextSecondary}" Margin="0,0,0,6"/>
                    <TextBox Text="{Binding TienThue, Converter={StaticResource NumberFormatConverter}, UpdateSourceTrigger=LostFocus}" 
                             Style="{StaticResource FormTextBoxStyle}" Margin="0,0,0,16"
                             InputMethod.IsInputMethodEnabled="False" Language="en-US"/>

                    <!-- Chỉ số điện -->
                    <TextBlock Text="Chỉ số điện" FontSize="13" 
                               Foreground="{StaticResource TextSecondary}" Margin="0,0,0,6"/>
                    <Grid Margin="0,0,0,16">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="20"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <TextBox Grid.Column="0" Text="{Binding SoDienThangTruoc, UpdateSourceTrigger=LostFocus}" 
                                 Style="{StaticResource FormTextBoxStyle}" 
                                 InputMethod.IsInputMethodEnabled="False" Language="en-US"/>
                        <TextBlock Grid.Column="1" Text="→" HorizontalAlignment="Center" 
                                   VerticalAlignment="Center" Foreground="{StaticResource TextSecondary}"/>
                        <TextBox Grid.Column="2" Text="{Binding SoDienThangNay, UpdateSourceTrigger=LostFocus}" 
                                 Style="{StaticResource FormTextBoxStyle}"
                                 InputMethod.IsInputMethodEnabled="False" Language="en-US"/>
                    </Grid>
                    <TextBlock FontSize="12" Foreground="{StaticResource TextSecondary}" 
                               Margin="0,0,0,16" HorizontalAlignment="Right">
                        <TextBlock.Text>
                            <Binding Path="TienDien" StringFormat="Tiền điện: {0:N0} VNĐ"/>
                        </TextBlock.Text>
                    </TextBlock>

                    <!-- Tiền nước -->
                    <TextBlock Text="Tiền nước (VNĐ)" FontSize="13" 
                               Foreground="{StaticResource TextSecondary}" Margin="0,0,0,6"/>
                    <TextBox Text="{Binding TienNuoc, Converter={StaticResource NumberFormatConverter}, UpdateSourceTrigger=LostFocus}" 
                             Style="{StaticResource FormTextBoxStyle}" Margin="0,0,0,16"
                             InputMethod.IsInputMethodEnabled="False" Language="en-US"/>

                    <!-- Tiền internet -->
                    <TextBlock Text="Tiền internet (VNĐ)" FontSize="13" 
                               Foreground="{StaticResource TextSecondary}" Margin="0,0,0,6"/>
                    <TextBox Text="{Binding TienInternet, Converter={StaticResource NumberFormatConverter}, UpdateSourceTrigger=LostFocus}" 
                             Style="{StaticResource FormTextBoxStyle}" Margin="0,0,0,16"
                             InputMethod.IsInputMethodEnabled="False" Language="en-US"/>

                    <!-- Tiền vệ sinh -->
                    <TextBlock Text="Tiền vệ sinh (VNĐ)" FontSize="13" 
                               Foreground="{StaticResource TextSecondary}" Margin="0,0,0,6"/>
                    <TextBox Text="{Binding TienVeSinh, Converter={StaticResource NumberFormatConverter}, UpdateSourceTrigger=LostFocus}" 
                             Style="{StaticResource FormTextBoxStyle}" Margin="0,0,0,16"
                             InputMethod.IsInputMethodEnabled="False" Language="en-US"/>

                    <!-- Tiền giữ xe -->
                    <TextBlock Text="Tiền giữ xe (VNĐ)" FontSize="13" 
                               Foreground="{StaticResource TextSecondary}" Margin="0,0,0,6"/>
                    <TextBox Text="{Binding TienGiuXe, Converter={StaticResource NumberFormatConverter}, UpdateSourceTrigger=LostFocus}" 
                             Style="{StaticResource FormTextBoxStyle}" Margin="0,0,0,16"
                             InputMethod.IsInputMethodEnabled="False" Language="en-US"/>

                    <!-- Chi phí khác -->
                    <TextBlock Text="Chi phí khác (VNĐ)" FontSize="13" 
                               Foreground="{StaticResource TextSecondary}" Margin="0,0,0,6"/>
                    <TextBox Text="{Binding ChiPhiKhac, Converter={StaticResource NumberFormatConverter}, UpdateSourceTrigger=LostFocus}" 
                             Style="{StaticResource FormTextBoxStyle}" Margin="0,0,0,20"
                             InputMethod.IsInputMethodEnabled="False" Language="en-US"/>

                    <!-- Total -->
                    <Border Background="{StaticResource BackgroundLighter}" CornerRadius="8" Padding="16">
                        <Grid>
                            <TextBlock Text="Tổng tiền" FontSize="16" FontWeight="Bold" 
                                       Foreground="{StaticResource TextPrimary}"/>
                            <TextBlock FontSize="18" FontWeight="Bold" 
                                       Foreground="{StaticResource SecondaryColor}" 
                                       HorizontalAlignment="Right">
                                <TextBlock.Text>
                                    <Binding Path="TongTien" StringFormat="{}{0:N0} VNĐ"/>
                                </TextBlock.Text>
                            </TextBlock>
                        </Grid>
                    </Border>
                </StackPanel>
            </ScrollViewer>

            <!-- Footer Buttons -->
            <Border Grid.Row="2" Background="{StaticResource BackgroundLighter}" 
                    BorderThickness="0,1,0,0" BorderBrush="{StaticResource BorderColor}" 
                    Padding="24,16">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    <Button Grid.Column="1" Content="Hủy" 
                            Command="{Binding CancelCommand}" 
                            Style="{StaticResource ModernPrimaryButton}" 
                            Background="{StaticResource BackgroundLight}" 
                            Foreground="{StaticResource TextPrimary}" 
                            BorderBrush="{StaticResource BorderColor}" 
                            BorderThickness="1" 
                            Margin="0,0,12,0"/>
                    <Button Grid.Column="2" Content="Lưu" 
                            Command="{Binding SaveCommand}" 
                            Style="{StaticResource ModernPrimaryButton}"/>
                </Grid>
            </Border>
        </Grid>
    </Border>
</Window>

