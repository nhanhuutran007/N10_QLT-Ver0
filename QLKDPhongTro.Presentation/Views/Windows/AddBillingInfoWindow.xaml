<Window x:Class="QLKDPhongTro.Presentation.Views.Windows.AddBillingInfoWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d"
    Title="Thêm thông tin thanh toán - Quản Lý Phòng Trọ"
    Height="650" Width="700"
    WindowStartupLocation="CenterOwner"
    ResizeMode="NoResize"
    WindowStyle="None"
    AllowsTransparency="True"
    Background="Transparent"
    FontFamily="Segoe UI"
    TextOptions.TextFormattingMode="Display"
    TextOptions.TextRenderingMode="ClearType"
    Icon="/Resources/Images/Logo.png"
    MouseLeftButtonDown="Window_MouseLeftButtonDown">

    <Window.Resources>
        <SolidColorBrush x:Key="PrimaryColor" Color="#10B981"/>
        <SolidColorBrush x:Key="PrimaryDarkColor" Color="#059669"/>
        <SolidColorBrush x:Key="SecondaryColor" Color="#3B82F6"/>
        <SolidColorBrush x:Key="SecondaryDarkColor" Color="#2563EB"/>
        <SolidColorBrush x:Key="AccentColor" Color="#8B5CF6"/>
        <SolidColorBrush x:Key="WarningColor" Color="#F59E0B"/>
        <SolidColorBrush x:Key="ErrorColor" Color="#EF4444"/>
        <SolidColorBrush x:Key="TextPrimary" Color="#1F2937"/>
        <SolidColorBrush x:Key="TextSecondary" Color="#6B7280"/>
        <SolidColorBrush x:Key="TextTertiary" Color="#9CA3AF"/>
        <SolidColorBrush x:Key="BackgroundLight" Color="#FFFFFF"/>
        <SolidColorBrush x:Key="BackgroundLighter" Color="#F9FAFB"/>
        <SolidColorBrush x:Key="BackgroundCard" Color="#FFFFFF"/>
        <SolidColorBrush x:Key="BorderColor" Color="#E5E7EB"/>
        <SolidColorBrush x:Key="BorderLightColor" Color="#F3F4F6"/>

        <LinearGradientBrush x:Key="PrimaryGradient" StartPoint="0,0" EndPoint="1,1">
            <GradientStop Color="#10B981" Offset="0"/>
            <GradientStop Color="#059669" Offset="1"/>
        </LinearGradientBrush>
        <LinearGradientBrush x:Key="SecondaryGradient" StartPoint="0,0" EndPoint="1,1">
            <GradientStop Color="#3B82F6" Offset="0"/>
            <GradientStop Color="#2563EB" Offset="1"/>
        </LinearGradientBrush>

        <DropShadowEffect x:Key="CardShadow" Color="#000000" Opacity="0.06" ShadowDepth="2" BlurRadius="12" Direction="270"/>
        <DropShadowEffect x:Key="HoverShadow" Color="#000000" Opacity="0.12" ShadowDepth="4" BlurRadius="16" Direction="270"/>
        <DropShadowEffect x:Key="ButtonShadow" Color="#000000" Opacity="0.1" ShadowDepth="1" BlurRadius="4" Direction="270"/>
        <DropShadowEffect x:Key="WindowShadow" Color="#000000" Opacity="0.15" ShadowDepth="8" BlurRadius="20" Direction="270"/>

        <Style TargetType="{x:Type Button}" x:Key="ModernPrimaryButton">
            <Setter Property="Background" Value="{StaticResource SecondaryGradient}"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Height" Value="42"/>
            <Setter Property="Padding" Value="20,0"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type Button}">
                        <Border x:Name="Border" CornerRadius="8" Background="{TemplateBinding Background}" Effect="{StaticResource ButtonShadow}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Border" Property="Effect" Value="{StaticResource HoverShadow}"/>
                                <Setter TargetName="Border" Property="Background" Value="{StaticResource SecondaryDarkColor}"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="Border" Property="Opacity" Value="0.9"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style TargetType="Button" x:Key="CloseButtonStyle">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Width" Value="32"/>
            <Setter Property="Height" Value="32"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="Border" Background="{TemplateBinding Background}" CornerRadius="6">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Border" Property="Background" Value="{StaticResource BackgroundLighter}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="LabelStyle" TargetType="TextBlock">
            <Setter Property="FontWeight" Value="Medium"/>
            <Setter Property="Foreground" Value="{StaticResource TextPrimary}"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="Margin" Value="0,16,0,8"/>
        </Style>

        <Style x:Key="InputFieldStyle" TargetType="TextBox">
            <Setter Property="Height" Value="42"/>
            <Setter Property="Padding" Value="12,0"/>
            <Setter Property="Background" Value="White"/>
            <Setter Property="BorderBrush" Value="{StaticResource BorderColor}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="Foreground" Value="{StaticResource TextPrimary}"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="BorderBrush" Value="{StaticResource SecondaryColor}"/>
                </Trigger>
                <Trigger Property="IsFocused" Value="True">
                    <Setter Property="BorderBrush" Value="{StaticResource SecondaryColor}"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="ReadOnlyInputFieldStyle" TargetType="TextBox" BasedOn="{StaticResource InputFieldStyle}">
            <Setter Property="Background" Value="{StaticResource BackgroundLighter}"/>
            <Setter Property="Foreground" Value="{StaticResource TextSecondary}"/>
            <Setter Property="IsReadOnly" Value="True"/>
            <Setter Property="Focusable" Value="False"/>
            <Setter Property="Cursor" Value="Arrow"/>
        </Style>

        <Style x:Key="ComboBoxStyle" TargetType="ComboBox">
            <Setter Property="Height" Value="42"/>
            <Setter Property="Padding" Value="12,0"/>
            <Setter Property="Background" Value="White"/>
            <Setter Property="BorderBrush" Value="{StaticResource BorderColor}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="Foreground" Value="{StaticResource TextPrimary}"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="BorderBrush" Value="{StaticResource SecondaryColor}"/>
                </Trigger>
                <Trigger Property="IsDropDownOpen" Value="True">
                    <Setter Property="BorderBrush" Value="{StaticResource SecondaryColor}"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="DatePickerStyle" TargetType="DatePicker">
            <Setter Property="Height" Value="42"/>
            <Setter Property="Padding" Value="8,0"/>
            <Setter Property="Background" Value="White"/>
            <Setter Property="BorderBrush" Value="{StaticResource BorderColor}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
            <Setter Property="FontSize" Value="14"/>
        </Style>

        <Style x:Key="CheckBoxStyle" TargetType="CheckBox">
            <Setter Property="Foreground" Value="{StaticResource TextPrimary}"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
            <Setter Property="Margin" Value="0,0,20,0"/>
        </Style>
    </Window.Resources>

    <Border CornerRadius="12"
            Background="{StaticResource BackgroundLight}"
            Margin="10"
            Effect="{StaticResource WindowShadow}">

        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <Border Grid.Row="0" 
                    Background="{StaticResource BackgroundLighter}"
                    CornerRadius="12,12,0,0"
                    BorderThickness="0,0,0,1"
                    BorderBrush="{StaticResource BorderColor}"
                    Padding="24,20">
                <Grid>
                    <TextBlock Text="Thêm thông tin thanh toán"
                            FontSize="20"
                            FontWeight="Bold"
                            Foreground="{StaticResource TextPrimary}"
                            VerticalAlignment="Center"/>
                    <Button x:Name="CloseButton"
                            Command="{Binding CancelCommand}"
                            CommandParameter="{Binding RelativeSource={RelativeSource AncestorType=Window}}"
                            HorizontalAlignment="Right"
                            VerticalAlignment="Center"
                            Style="{StaticResource CloseButtonStyle}"
                            ToolTip="Đóng">
                        <TextBlock Text="✕"
                                FontSize="16"
                                Foreground="{StaticResource TextSecondary}"
                                VerticalAlignment="Center"
                                HorizontalAlignment="Center"/>
                    </Button>
                </Grid>
            </Border>

            <ScrollViewer Grid.Row="1"
                    VerticalScrollBarVisibility="Auto"
                    Padding="24">
                <StackPanel>
                    <TextBlock Text="Khách hàng" Style="{StaticResource LabelStyle}"/>
                    <ComboBox x:Name="CustomerComboBox"
                            Style="{StaticResource ComboBoxStyle}"
                            IsEditable="True">
                    </ComboBox>

                    <TextBlock Text="Mã hợp đồng" Style="{StaticResource LabelStyle}"/>
                    <ComboBox x:Name="ContractIdComboBox"
                            Style="{StaticResource ComboBoxStyle}"
                            ItemsSource="{Binding Contracts}"
                            SelectedItem="{Binding SelectedContract}"
                            DisplayMemberPath="MaHopDong">
                    </ComboBox>

                    <TextBlock Text="Tên phòng" Style="{StaticResource LabelStyle}"/>
                    <TextBox x:Name="RoomNameTextBox"
                             Text="{Binding RoomName}"
                             Style="{StaticResource ReadOnlyInputFieldStyle}"
                             IsReadOnly="True"
                             ToolTip="Tên phòng được lấy tự động từ hợp đồng đã chọn"/>     

                    <TextBlock Text="Tiền thuê phòng" Style="{StaticResource LabelStyle}"/>
                    <TextBox x:Name="TienThueInput"
                            Text="{Binding Amount, StringFormat=N0, UpdateSourceTrigger=PropertyChanged}"
                            Style="{StaticResource InputFieldStyle}"/>

                    <TextBlock Text="Chỉ số điện" Style="{StaticResource LabelStyle}"/>
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <TextBox x:Name="SoDienInput"
                                Grid.Column="0"
                                Text="{Binding SoDien, UpdateSourceTrigger=PropertyChanged}"
                                Style="{StaticResource InputFieldStyle}"
                                ToolTip="Nhập chỉ số điện (kWh)"/>
                        <TextBlock Text="/"
                                Grid.Column="1"
                                VerticalAlignment="Center"
                                HorizontalAlignment="Center"
                                Foreground="{StaticResource TextTertiary}"
                                Margin="8,0"/>
                        <TextBox x:Name="DonGiaDienInput"
                                Grid.Column="2"
                                Text="{Binding DonGiaDien, StringFormat=N0, UpdateSourceTrigger=PropertyChanged}"
                                Style="{StaticResource InputFieldStyle}"
                                ToolTip="Nhập đơn giá điện (đồng/kWh)"/>
                    </Grid>
                    <TextBlock Text="(Ví dụ: 100 / 3500 = 350,000 đồng)"
                            FontSize="12"
                            Foreground="{StaticResource TextTertiary}"
                            Margin="0,4,0,0"/>

                    <TextBlock Text="Chỉ số nước (Khoán)" Style="{StaticResource LabelStyle}"/>
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <TextBox x:Name="SoNuocInput"
                                Grid.Column="0"
                                Text="{Binding SoNuoc, UpdateSourceTrigger=PropertyChanged}"
                                Style="{StaticResource ReadOnlyInputFieldStyle}"
                                IsReadOnly="True"
                                ToolTip="Mặc định theo phòng (1)"/>

                        <TextBlock Text="/"
                                Grid.Column="1"
                                VerticalAlignment="Center"
                                HorizontalAlignment="Center"
                                Foreground="{StaticResource TextTertiary}"
                                Margin="8,0"/>

                        <TextBox x:Name="DonGiaNuocInput"
                                Grid.Column="2"
                                Text="{Binding DonGiaNuoc, StringFormat=N0, UpdateSourceTrigger=PropertyChanged}"
                                Style="{StaticResource ReadOnlyInputFieldStyle}"
                                IsReadOnly="True"
                                ToolTip="Đơn giá khoán mặc định"/>
                    </Grid>
                    <TextBlock Text="(Cố định: 100,000 đồng/phòng)"
                            FontSize="12"
                            Foreground="{StaticResource TextTertiary}"
                            Margin="0,4,0,0"/>

                    <TextBlock Text="Tiền Internet" Style="{StaticResource LabelStyle}"/>
                    <TextBox x:Name="TienInternetInput"
                            Text="{Binding TienInternet, StringFormat=N0, UpdateSourceTrigger=PropertyChanged}"
                            Style="{StaticResource InputFieldStyle}"/>

                    <TextBlock Text="Tiền vệ sinh" Style="{StaticResource LabelStyle}"/>
                    <TextBox x:Name="TienVeSinhInput"
                            Text="{Binding TienVeSinh, StringFormat=N0, UpdateSourceTrigger=PropertyChanged}"
                            Style="{StaticResource InputFieldStyle}"/>

                    <TextBlock Text="Tiền giữ xe" Style="{StaticResource LabelStyle}"/>
                    <TextBox x:Name="TienGiuXeInput"
                            Text="{Binding TienGiuXe, StringFormat=N0, UpdateSourceTrigger=PropertyChanged}"
                            Style="{StaticResource InputFieldStyle}"/>

                    <TextBlock Text="Chi phí khác" Style="{StaticResource LabelStyle}"/>
                    <TextBox x:Name="ChiPhiKhacInput"
                            Text="{Binding ChiPhiKhac, StringFormat=N0, UpdateSourceTrigger=PropertyChanged}"
                            Style="{StaticResource InputFieldStyle}"/>

                    <TextBlock Text="Ngày tạo" Style="{StaticResource LabelStyle}"/>
                    <DatePicker x:Name="CreatedDatePicker"
                            SelectedDate="{Binding PaymentDate}"
                            Style="{StaticResource DatePickerStyle}"/>

                    <TextBlock Text="Thông báo qua" 
                            Style="{StaticResource LabelStyle}"
                            Margin="0,20,0,8"/>
                    <TextBlock Text="Khách hàng nhận thông báo thanh toán qua:"
                            Foreground="{StaticResource TextSecondary}"
                            FontSize="14"
                            Margin="0,0,0,12"/>
                    <StackPanel Orientation="Horizontal">
                        <CheckBox Content="Trực tiếp"
                                IsChecked="True"
                                Style="{StaticResource CheckBoxStyle}"/>
                        <CheckBox Content="Email"
                                Style="{StaticResource CheckBoxStyle}"/>
                    </StackPanel>

                    <Button x:Name="AddButton"
                            Command="{Binding SavePaymentCommand}"
                            Content="Thêm thông tin"
                            Style="{StaticResource ModernPrimaryButton}"
                            Width="160"
                            Height="44"
                            FontSize="14"
                            HorizontalAlignment="Right"
                            Margin="0,32,0,16"
                            Cursor="Hand">
                        <Button.Resources>
                            <Style TargetType="Border">
                                <Style.Triggers>
                                    <Trigger Property="IsMouseOver" Value="True">
                                        <Setter Property="Background" Value="{StaticResource PrimaryDarkColor}"/>
                                    </Trigger>
                                </Style.Triggers>
                            </Style>
                        </Button.Resources>
                    </Button>
                </StackPanel>
            </ScrollViewer>
        </Grid>
    </Border>
</Window>